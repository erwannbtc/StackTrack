<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackTrack - Bitcoin Portfolio Tracker</title>

    <!-- PWA Meta -->
    <meta name="theme-color" content="#f7931a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="StackTrack">

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            background: #f8f9fa;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #f7931a, #ff6b35);
            color: white;
            padding: 60px 20px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateX(-100px) translateY(-100px); }
            100% { transform: translateX(100px) translateY(100px); }
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 10px;
            z-index: 10;
            position: relative;
        }

        .btc-amount {
            font-size: 28px;
            font-weight: 700;
            margin: 20px 0;
            z-index: 10;
            position: relative;
        }

        .rank-info {
            font-size: 14px;
            opacity: 0.9;
            z-index: 10;
            position: relative;
        }

        .nav-tabs {
            display: flex;
            background: white;
            margin: 0 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #f7931a, #ff6b35);
            color: white;
            transform: scale(1.05);
        }

        .content {
            padding: 30px 20px;
            min-height: 60vh;
        }

        .page {
            display: none;
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin: 20px 0;
        }

        .objectives-list {
            margin-top: 20px;
        }

        .objective-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #f7931a;
        }

        .objective-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .objective-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f7931a, #ff6b35);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-input:focus {
            outline: none;
            border-color: #f7931a;
            background: white;
            transform: scale(1.02);
        }

        .btn {
            background: linear-gradient(135deg, #f7931a, #ff6b35);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(247, 147, 26, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #f7931a;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }

        .premium-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
        }

        .premium-code {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }

        .premium-code::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .transaction-history {
            margin-top: 20px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 16px;
        }

        .transaction-amount.positive {
            color: #28a745;
        }

        .transaction-amount.negative {
            color: #dc3545;
        }

        .transaction-date {
            font-size: 12px;
            color: #6c757d;
        }

        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f7931a, #ff6b35);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(247, 147, 26, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action:hover {
            transform: scale(1.1);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #f7931a;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-tab {
                font-size: 10px;
                padding: 12px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo">‚ö° StackTrack</div>
            <div class="btc-amount" id="totalBTC">0.00000000 ‚Çø</div>
            <div class="rank-info" id="rankInfo">Calcul du rang en cours...</div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showPage('add')">Stack</button>
            <button class="nav-tab" onclick="showPage('objectives')">Objectifs</button>
            <button class="nav-tab" onclick="showPage('indicators')">Donn√©es</button>
            <button class="nav-tab" onclick="showPage('premium')">Premium</button>
        </div>

        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="card">
                    <h3>√âvolution du Stack</h3>
                    <div class="chart-container">
                        <canvas id="stackChart"></canvas>
                    </div>
                </div>

                <div class="objectives-list" id="activeObjectives">
                    <h3>Objectifs Actifs</h3>
                    <div id="objectivesList"></div>
                </div>
            </div>

            <!-- Add/Remove Stack Page -->
            <div id="add" class="page">
                <div class="card">
                    <h3>G√©rer votre Stack</h3>
                    <form id="stackForm">
                        <div class="form-group">
                            <label class="form-label">Montant (‚Çø)</label>
                            <input type="number" class="form-input" id="amount" placeholder="0.00000000" step="0.00000001" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-input" id="date" required>
                        </div>
                        <button type="submit" class="btn" data-action="add">Ajouter au Stack</button>
                        <button type="button" class="btn btn-secondary" onclick="removeFromStack()">Retirer du Stack</button>
                    </form>
                </div>

                <div class="transaction-history">
                    <h3>Historique</h3>
                    <div id="transactionHistory"></div>
                </div>
            </div>

            <!-- Objectives Page -->
            <div id="objectives" class="page">
                <div class="card">
                    <h3>Nouvel Objectif</h3>
                    <form id="objectiveForm">
                        <div class="form-group">
                            <label class="form-label">Nom de l'objectif</label>
                            <input type="text" class="form-input" id="objectiveName" placeholder="Ex: Premier Bitcoin complet" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <input type="text" class="form-input" id="objectiveDescription" placeholder="Description optionnelle">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Montant cible (‚Çø)</label>
                            <input type="number" class="form-input" id="objectiveTarget" placeholder="0.00000000" step="0.00000001" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date cible (optionnelle)</label>
                            <input type="date" class="form-input" id="objectiveDate">
                        </div>
                        <button type="submit" class="btn">Cr√©er l'Objectif</button>
                    </form>
                </div>

                <div id="allObjectives">
                    <h3>Tous les Objectifs</h3>
                    <div id="allObjectivesList"></div>
                </div>
            </div>

            <!-- Bitcoin Indicators Page -->
            <div id="indicators" class="page">
                <div class="loading" id="indicatorsLoading">
                    <div class="spinner"></div>
                    Chargement des donn√©es Bitcoin...
                </div>

                <div id="indicatorsContent" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="currentBlock">0</div>
                            <div class="stat-label">Bloc Actuel</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="btcMined">0</div>
                            <div class="stat-label">BTC Min√©s</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="btcRemaining">21M</div>
                            <div class="stat-label">BTC Restants</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="currentReward">6.25</div>
                            <div class="stat-label">R√©compense/Bloc</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Halving</h3>
                        <p><strong>Era actuelle:</strong> <span id="currentEra">4</span></p>
                        <p><strong>Prochain halving:</strong> Bloc <span id="nextHalvingBlock">840000</span></p>
                        <p><strong>Blocs restants:</strong> <span id="blocksToHalving">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Premium Page -->
            <div id="premium" class="page">
                <div class="premium-card">
                    <h3>‚ö° Premium Features</h3>
                    <p>D√©bloquez les profils multiples pour g√©rer plusieurs portefeuilles (famille, investissements, etc.)</p>

                    <div style="margin: 20px 0;">
                        <p><strong>Votre ID:</strong></p>
                        <p style="font-family: monospace; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin: 10px 0;" id="accountId"></p>
                    </div>

                    <input type="text" class="premium-code" id="activationCode" placeholder="Entrez votre code d'activation">
                    <button class="btn" onclick="activatePremium()" style="background: rgba(255,255,255,0.2); margin-top: 10px;">Activer Premium</button>
                </div>

                <div class="card" id="premiumFeatures" style="display: none;">
                    <h3>Profils Premium Activ√©s ‚úÖ</h3>
                    <button class="btn" onclick="createNewProfile()">Cr√©er un Nouveau Profil</button>
                    <div id="profilesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA Manifest -->
    <script>
        // PWA Manifest
        const manifest = {
            name: "StackTrack - Bitcoin Portfolio Tracker",
            short_name: "StackTrack",
            description: "Suivez votre portefeuille Bitcoin de mani√®re souveraine",
            start_url: "/",
            display: "standalone",
            background_color: "#f7931a",
            theme_color: "#f7931a",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMzIiIGZpbGw9IiNmNzkzMWEiLz4KPHRleHQgeD0iOTYiIHk9IjExMCIgZm9udC1mYW1pbHk9InN5c3RlbS11aSIgZm9udC1zaXplPSI3MiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7igKE8L3RleHQ+Cjwvc3ZnPgo=",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };

        // Register service worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'stacktrack-v1';
                const urlsToCache = ['/'];

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;

            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl);
        }

        // Add manifest
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestUrl;
        document.head.appendChild(link);
    </script>

    <script>
        // App State
        let appData = {
            stack: parseFloat(localStorage.getItem('btcStack') || '0'),
            transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
            objectives: JSON.parse(localStorage.getItem('objectives') || '[]'),
            accountId: localStorage.getItem('accountId') || generateAccountId(),
            isPremium: localStorage.getItem('isPremium') === 'true',
            profiles: JSON.parse(localStorage.getItem('profiles') || '[]'),
            currentProfile: localStorage.getItem('currentProfile') || 'default'
        };

        let stackChart = null;

        // Generate unique account ID
        function generateAccountId() {
            const id = 'ST' + Math.random().toString(36).substr(2, 9).toUpperCase();
            localStorage.setItem('accountId', id);
            return id;
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('btcStack', appData.stack.toString());
            localStorage.setItem('transactions', JSON.stringify(appData.transactions));
            localStorage.setItem('objectives', JSON.stringify(appData.objectives));
            localStorage.setItem('isPremium', appData.isPremium.toString());
            localStorage.setItem('profiles', JSON.stringify(appData.profiles));
            localStorage.setItem('currentProfile', appData.currentProfile);
        }

        // Update total BTC display
        function updateBTCDisplay() {
            document.getElementById('totalBTC').textContent = appData.stack.toFixed(8) + ' ‚Çø';
            updateRankInfo();
        }

        // Update rank information
        function updateRankInfo() {
            if (appData.stack > 0) {
                const rank = Math.floor(21000000 / appData.stack);
                document.getElementById('rankInfo').textContent = 
                    `Avec ${appData.stack.toFixed(8)} ‚Çø, tu es dans le top ${rank.toLocaleString()}/21,000,000`;
            } else {
                document.getElementById('rankInfo').textContent = 'Commencez √† stacker pour voir votre rang !';
            }
        }

        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Add active to selected tab
            event.target.classList.add('active');

            // Special actions per page
            if (pageId === 'dashboard') {
                updateChart();
                updateObjectivesList();
            } else if (pageId === 'indicators') {
                loadBitcoinIndicators();
            } else if (pageId === 'add') {
                updateTransactionHistory();
            } else if (pageId === 'objectives') {
                updateAllObjectivesList();
            } else if (pageId === 'premium') {
                updatePremiumPage();
            }
        }

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('stackChart').getContext('2d');

            // Generate sample data based on transactions
            const chartData = generateChartData();

            stackChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Stack BTC',
                        data: chartData.data,
                        borderColor: '#f7931a',
                        backgroundColor: 'rgba(247, 147, 26, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#f7931a',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(8) + ' ‚Çø';
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        // Generate chart data from transactions
        function generateChartData() {
            if (appData.transactions.length === 0) {
                return {
                    labels: ['D√©but'],
                    data: [0]
                };
            }

            // Sort transactions by date
            const sortedTransactions = [...appData.transactions].sort((a, b) => new Date(a.date) - new Date(b.date));

            const labels = [];
            const data = [];
            let runningTotal = 0;

            sortedTransactions.forEach(transaction => {
                runningTotal += transaction.amount;
                labels.push(new Date(transaction.date).toLocaleDateString('fr-FR'));
                data.push(runningTotal);
            });

            return { labels, data };
        }

        // Update chart
        function updateChart() {
            if (stackChart) {
                const chartData = generateChartData();
                stackChart.data.labels = chartData.labels;
                stackChart.data.datasets[0].data = chartData.data;
                stackChart.update('active');
            }
        }

        // Add to stack
        function addToStack() {
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;

            if (amount && date) {
                const transaction = {
                    id: Date.now(),
                    amount: amount,
                    date: date,
                    type: 'add'
                };

                appData.stack += amount;
                appData.transactions.push(transaction);

                saveData();
                updateBTCDisplay();
                updateChart();
                updateTransactionHistory();

                // Reset form
                document.getElementById('stackForm').reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0];

                // Success animation
                const button = document.querySelector('[data-action="add"]');
                button.classList.add('pulse');
                setTimeout(() => button.classList.remove('pulse'), 1000);

                // Check objectives
                checkObjectives();
            }
        }

        // Remove from stack
        function removeFromStack() {
            const amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;

            if (amount && date && amount <= appData.stack) {
                const transaction = {
                    id: Date.now(),
                    amount: -amount,
                    date: date,
                    type: 'remove'
                };

                appData.stack -= amount;
                appData.transactions.push(transaction);

                saveData();
                updateBTCDisplay();
                updateChart();
                updateTransactionHistory();

                // Reset form
                document.getElementById('stackForm').reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
            } else {
                alert('Montant invalide ou sup√©rieur au stack actuel !');
            }
        }

        // Update transaction history
        function updateTransactionHistory() {
            const container = document.getElementById('transactionHistory');
            const sortedTransactions = [...appData.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedTransactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Aucune transaction</p>';
                return;
            }

            container.innerHTML = sortedTransactions.map(transaction => `
                <div class="transaction-item">
                    <div>
                        <div class="transaction-amount ${transaction.amount > 0 ? 'positive' : 'negative'}">
                            ${transaction.amount > 0 ? '+' : ''}${transaction.amount.toFixed(8)} ‚Çø
                        </div>
                        <div class="transaction-date">${new Date(transaction.date).toLocaleDateString('fr-FR')}</div>
                    </div>
                    <div style="font-size: 12px; color: #6c757d;">
                        ${transaction.type === 'add' ? 'üìà Ajout' : 'üìâ Retrait'}
                    </div>
                </div>
            `).join('');
        }

        // Add objective
        function addObjective() {
            const name = document.getElementById('objectiveName').value;
            const description = document.getElementById('objectiveDescription').value;
            const target = parseFloat(document.getElementById('objectiveTarget').value);
            const date = document.getElementById('objectiveDate').value;

            if (name && target) {
                const objective = {
                    id: Date.now(),
                    name: name,
                    description: description,
                    target: target,
                    date: date,
                    completed: false,
                    archived: false
                };

                appData.objectives.push(objective);
                saveData();
                updateObjectivesList();
                updateAllObjectivesList();

                // Reset form
                document.getElementById('objectiveForm').reset();

                alert('Objectif cr√©√© avec succ√®s !');
            }
        }

        // Update objectives list (dashboard)
        function updateObjectivesList() {
            const container = document.getElementById('objectivesList');
            const activeObjectives = appData.objectives.filter(obj => !obj.completed && !obj.archived);

            if (activeObjectives.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Aucun objectif actif</p>';
                return;
            }

            container.innerHTML = activeObjectives.map(objective => {
                const progress = Math.min((appData.stack / objective.target) * 100, 100);
                const isCompleted = progress >= 100;

                return `
                    <div class="objective-item ${isCompleted ? 'pulse' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4>${objective.name}</h4>
                            <span style="font-size: 12px; color: #6c757d;">${progress.toFixed(1)}%</span>
                        </div>
                        ${objective.description ? `<p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">${objective.description}</p>` : ''}
                        <div class="objective-progress">
                            <div class="objective-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6c757d; margin-top: 10px;">
                            <span>${appData.stack.toFixed(8)} / ${objective.target.toFixed(8)} ‚Çø</span>
                            ${objective.date ? `<span>√âch√©ance: ${new Date(objective.date).toLocaleDateString('fr-FR')}</span>` : ''}
                        </div>
                        ${isCompleted ? `<button class="btn" style="margin-top: 10px; padding: 8px 15px; font-size: 12px;" onclick="completeObjective(${objective.id})">Marquer comme Atteint üéâ</button>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Update all objectives list
        function updateAllObjectivesList() {
            const container = document.getElementById('allObjectivesList');

            if (appData.objectives.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Aucun objectif cr√©√©</p>';
                return;
            }

            container.innerHTML = appData.objectives.map(objective => {
                const progress = Math.min((appData.stack / objective.target) * 100, 100);
                let statusIcon = 'üéØ';
                let statusText = 'En cours';

                if (objective.completed) {
                    statusIcon = '‚úÖ';
                    statusText = 'Atteint';
                } else if (objective.archived) {
                    statusIcon = 'üìÅ';
                    statusText = 'Archiv√©';
                }

                return `
                    <div class="objective-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4>${statusIcon} ${objective.name}</h4>
                            <span style="font-size: 12px; color: #6c757d;">${statusText}</span>
                        </div>
                        ${objective.description ? `<p style="color: #6c757d; font-size: 14px; margin-bottom: 10px;">${objective.description}</p>` : ''}
                        <div class="objective-progress">
                            <div class="objective-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6c757d; margin-top: 10px;">
                            <span>${appData.stack.toFixed(8)} / ${objective.target.toFixed(8)} ‚Çø</span>
                            ${objective.date ? `<span>√âch√©ance: ${new Date(objective.date).toLocaleDateString('fr-FR')}</span>` : ''}
                        </div>
                        <div style="margin-top: 10px;">
                            ${!objective.completed && !objective.archived ? `<button class="btn" style="padding: 5px 10px; font-size: 11px; margin-right: 5px;" onclick="completeObjective(${objective.id})">Marquer Atteint</button>` : ''}
                            ${!objective.archived ? `<button class="btn btn-secondary" style="padding: 5px 10px; font-size: 11px; margin-right: 5px;" onclick="archiveObjective(${objective.id})">Archiver</button>` : ''}
                            <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 11px;" onclick="deleteObjective(${objective.id})">Supprimer</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Complete objective
        function completeObjective(id) {
            const objective = appData.objectives.find(obj => obj.id === id);
            if (objective) {
                objective.completed = true;
                saveData();
                updateObjectivesList();
                updateAllObjectivesList();

                // Celebration animation
                alert(`üéâ F√©licitations ! Objectif "${objective.name}" atteint !`);
            }
        }

        // Archive objective
        function archiveObjective(id) {
            const objective = appData.objectives.find(obj => obj.id === id);
            if (objective) {
                objective.archived = true;
                saveData();
                updateObjectivesList();
                updateAllObjectivesList();
            }
        }

        // Delete objective
        function deleteObjective(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet objectif ?')) {
                appData.objectives = appData.objectives.filter(obj => obj.id !== id);
                saveData();
                updateObjectivesList();
                updateAllObjectivesList();
            }
        }

        // Check objectives completion
        function checkObjectives() {
            appData.objectives.forEach(objective => {
                if (!objective.completed && !objective.archived && appData.stack >= objective.target) {
                    // Auto-mark as completed if target reached
                    objective.completed = true;
                    setTimeout(() => {
                        alert(`üéâ Objectif "${objective.name}" automatiquement atteint !`);
                    }, 500);
                }
            });
            saveData();
        }

        // Load Bitcoin indicators
        async function loadBitcoinIndicators() {
            const loading = document.getElementById('indicatorsLoading');
            const content = document.getElementById('indicatorsContent');

            loading.style.display = 'block';
            content.style.display = 'none';

            try {
                // Try to fetch from mempool.space
                const response = await fetch('https://mempool.space/api/blocks/tip/height');
                const currentBlock = await response.json();

                // Calculate Bitcoin metrics
                const halvingInterval = 210000;
                const initialReward = 50;
                const halvingCount = Math.floor(currentBlock / halvingInterval);
                const currentReward = initialReward / Math.pow(2, halvingCount);
                const nextHalvingBlock = (halvingCount + 1) * halvingInterval;
                const blocksToHalving = nextHalvingBlock - currentBlock;

                // Estimate mined BTC
                let totalMined = 0;
                for (let i = 0; i <= halvingCount; i++) {
                    const blocksInThisEra = i === halvingCount ? currentBlock % halvingInterval : halvingInterval;
                    const rewardInThisEra = initialReward / Math.pow(2, i);
                    totalMined += blocksInThisEra * rewardInThisEra;
                }

                const btcRemaining = 21000000 - totalMined;

                // Update UI
                document.getElementById('currentBlock').textContent = currentBlock.toLocaleString();
                document.getElementById('btcMined').textContent = (totalMined / 1000000).toFixed(2) + 'M';
                document.getElementById('btcRemaining').textContent = (btcRemaining / 1000000).toFixed(2) + 'M';
                document.getElementById('currentReward').textContent = currentReward.toFixed(8);
                document.getElementById('currentEra').textContent = halvingCount + 1;
                document.getElementById('nextHalvingBlock').textContent = nextHalvingBlock.toLocaleString();
                document.getElementById('blocksToHalving').textContent = blocksToHalving.toLocaleString();

            } catch (error) {
                console.error('Error fetching Bitcoin data:', error);

                // Fallback with estimated values
                const estimatedBlock = 800000; // Estimation
                const halvingCount = 3;
                const currentReward = 6.25;
                const nextHalvingBlock = 840000;
                const blocksToHalving = nextHalvingBlock - estimatedBlock;

                document.getElementById('currentBlock').textContent = estimatedBlock.toLocaleString() + ' (est.)';
                document.getElementById('btcMined').textContent = '19.5M (est.)';
                document.getElementById('btcRemaining').textContent = '1.5M (est.)';
                document.getElementById('currentReward').textContent = currentReward.toString();
                document.getElementById('currentEra').textContent = '4';
                document.getElementById('nextHalvingBlock').textContent = nextHalvingBlock.toLocaleString();
                document.getElementById('blocksToHalving').textContent = blocksToHalving.toLocaleString() + ' (est.)';
            }

            loading.style.display = 'none';
            content.style.display = 'block';
        }

        // Premium functions
        function updatePremiumPage() {
            document.getElementById('accountId').textContent = appData.accountId;

            if (appData.isPremium) {
                document.getElementById('premiumFeatures').style.display = 'block';
                updateProfilesList();
            }
        }

        // Activate premium
        function activatePremium() {
            const code = document.getElementById('activationCode').value.trim();

            // Simple validation - in real app, this would be more secure
            const validCode = generateActivationCode(appData.accountId);

            if (code === validCode || code === 'PREMIUM2024') { // Debug code
                appData.isPremium = true;
                saveData();
                alert('üéâ Premium activ√© avec succ√®s !');
                updatePremiumPage();
            } else {
                alert('‚ùå Code d\'activation invalide');
            }
        }

        // Generate activation code (simplified)
        function generateActivationCode(accountId) {
            // In real app, this would use proper cryptographic functions
            return 'STACK' + accountId.slice(-4) + '2024';
        }

        // Create new profile
        function createNewProfile() {
            const profileName = prompt('Nom du nouveau profil:');
            if (profileName) {
                const newProfile = {
                    id: Date.now(),
                    name: profileName,
                    stack: 0,
                    transactions: [],
                    objectives: []
                };

                appData.profiles.push(newProfile);
                saveData();
                updateProfilesList();
            }
        }

        // Update profiles list
        function updateProfilesList() {
            const container = document.getElementById('profilesList');

            if (appData.profiles.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Aucun profil cr√©√©</p>';
                return;
            }

            container.innerHTML = appData.profiles.map(profile => `
                <div class="card" style="margin-top: 15px;">
                    <h4>${profile.name}</h4>
                    <p>Stack: ${profile.stack.toFixed(8)} ‚Çø</p>
                    <p>Transactions: ${profile.transactions.length}</p>
                    <p>Objectifs: ${profile.objectives.length}</p>
                    <button class="btn" style="padding: 8px 15px; font-size: 12px;" onclick="switchProfile('${profile.id}')">Basculer vers ce profil</button>
                </div>
            `).join('');
        }

        // Switch profile
        function switchProfile(profileId) {
            // Save current profile data
            const currentProfileData = {
                stack: appData.stack,
                transactions: appData.transactions,
                objectives: appData.objectives
            };

            // Find or create profile
            let profile = appData.profiles.find(p => p.id == profileId);
            if (!profile) {
                profile = {
                    id: profileId,
                    name: 'Profil ' + profileId,
                    stack: 0,
                    transactions: [],
                    objectives: []
                };
                appData.profiles.push(profile);
            }

            // Switch to new profile
            appData.stack = profile.stack;
            appData.transactions = profile.transactions;
            appData.objectives = profile.objectives;
            appData.currentProfile = profileId;

            saveData();
            updateBTCDisplay();
            updateChart();

            alert(`Bascul√© vers le profil: ${profile.name}`);
        }

        // Form event listeners
        document.getElementById('stackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addToStack();
        });

        document.getElementById('objectiveForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addObjective();
        });

        // Initialize app
        function initApp() {
            // Set current date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;

            // Update displays
            updateBTCDisplay();
            updateTransactionHistory();
            updateObjectivesList();
            updateAllObjectivesList();
            updatePremiumPage();

            // Initialize chart
            setTimeout(() => {
                initChart();
            }, 100);

            // Load Bitcoin indicators if on that page
            if (document.getElementById('indicators').classList.contains('active')) {
                loadBitcoinIndicators();
            }
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', initApp);

        // Add install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show install button or banner
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div style="position: fixed; bottom: 80px; left: 20px; right: 20px; background: linear-gradient(135deg, #f7931a, #ff6b35); color: white; padding: 15px; border-radius: 15px; text-align: center; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                    <p style="margin: 0 0 10px 0; font-weight: 600;">Installer StackTrack</p>
                    <button onclick="installPWA()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: 600; cursor: pointer;">Installer l'App</button>
                    <button onclick="this.parentElement.remove()" style="background: none; color: white; border: none; padding: 8px 15px; font-size: 20px; cursor: pointer; float: right; margin-top: -35px;">√ó</button>
                </div>
            `;
            document.body.appendChild(installBanner);
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((result) => {
                    if (result.outcome === 'accepted') {
                        console.log('PWA install√©e');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Add some nice touch interactions
        document.addEventListener('touchstart', function() {}, {passive: true});

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Add haptic feedback on supported devices
        function hapticFeedback() {
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Add to button clicks
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn')) {
                hapticFeedback();
            }
        });
    </script>
</body>
</html>